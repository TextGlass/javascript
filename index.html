<html>
<head>
  <title>TextGlass</title>
</head>
<body onload="main()">
  <h1>TextGlass Javascript Client</h1>
  Pattern file: <input id="pattern" type="text" size="60" value="http://www.rezsoft.org/textglass/reference/domains/a/patterns.json"><br>
  <br>
  Attribute file: <input id="attribute" type="text" size="60" value="http://www.rezsoft.org/textglass/reference/domains/a/attributes.json"><br>
  <br>
  <div id="clientout"></div>
  <br>
  Test file: <input id="test" type="text" size="60" value="http://www.rezsoft.org/textglass/reference/domains/a/test.json"><br>
  <br>
  <div id="testout"></div>
  <br>
  Test input: <input id="input" type="text" size="80" value=""><br>
  <br>
  <div id="inputout"></div>
  <br>
  <input id="load" type="button" value="Load" onclick="load()"><br>
  <br>
  <div class="out">
    <textarea id="out" rows="8" cols="80" disabled></textarea>
  </div>
  <script>
    function get(id) {
      return document.getElementById(id);
    }
    if(document.body.clientWidth < 800) {
      get('out').cols = Math.floor(((document.body.clientWidth - 40) / 8));
    }

    get('input').value = navigator.userAgent;

    var textglass = textglass || {};

    textglass.debugLevel = 3;

    textglass.debug = function(level, s) {
      if(level <= textglass.debugLevel) {
        var params = Array.prototype.slice.call(arguments, 0);
        params[0] = 'textglass';
        console.log.apply(console, params);
        
        var out = get('out');
        var line = out.value ? '\n' : '';
        
        for(var i = 1; i < arguments.length; i++) {
          if(i > 1) {
            line += ' ';
          }
          line += arguments[i];
        }
        
        out.value += line;
        out.scrollTop = out.scrollHeight;
      }
    };

    function load() {
      textglass.debug(3, 'Load button clicked');

      get('clientout').innerHTML = 'Loading...';
      get('testout').innerHTML = '';
      get('inputout').innerHTML = '';
      
      var button = get('load');

      button.disabled = true;

      var pattern = get('pattern').value;
      var attribute = get('attribute').value;
      var test = get('test').value;
      var input = get('input').value;

      textglass.loadURLs(pattern, attribute, undefined, undefined, function(state, msg) {
        textglass.debug(3, 'textglass.loadURL() callback', state, msg);

        get('clientout').innerHTML = state + (msg ? ': ' + msg : '');

        if(state === 'ready') {
          textglasstest.loadURL(test, function(state, msg) {
            textglass.debug(3, 'textglasstest.loadURL() callback', state, msg);

            get('testout').innerHTML = state + (msg ? ': ' + msg : '');
          });

          var inputout = textglass.domains[msg].classify(input);

          textglass.debug(1, 'input result', inputout);

          get('inputout').innerHTML = JSON.stringify(inputout, null, 2);
        }

        button.disabled = false;
      });
    }

    function main() {
      if(textglass.loaded) {
        textglass.debug(1, 'TextGlass Javascript Client', textglass.version, "LOADED!");
      }
    }
  </script>
  <script src="js/textglass.js"></script>
  <script src="js/textglasstest.js"></script>
</body>
</html>
